<!DOCTYPE html>
<html>
<head>
    <title>Agency List</title>
</head>
<body>
<select id="agencyDropdown" onchange="fetchAgencyData()">
    <option value="">Select an agency</option>
</select>

<div>Word Count: <div id="wordCount"></div></div>

<script>
    async function loadAgencies() {
      try {
        const response = await fetch('/api/agencies/getAllAgencies');
        if (!response.ok) throw new Error('Network error');
        const agenciesMap = await response.json();

        const dropdown = document.getElementById('agencyDropdown');
        dropdown.innerHTML = '<option value="">Select an agency</option>'; // reset options

        for (const id in agenciesMap) {
          if (agenciesMap.hasOwnProperty(id)) {
            const name = agenciesMap[id];
            const option = document.createElement('option');
            option.value = id;
            option.textContent = name;
            dropdown.appendChild(option);
          }
        }
      } catch (error) {
        console.error('Failed to load agencies:', error);
      }
    }

    function fetchAgencyData() {
      const agencySlug = document.getElementById('agencyDropdown').value;
      console.log("Agency Slug: " + agencySlug);
      fetch(`/api/agencies/getWordCount/${agencySlug}`)
        .then(response => response.text())
        .then(data => {
          document.getElementById('wordCount').innerText = data;
        });
  }

    window.onload = loadAgencies;
</script>
</body>
</html>
